#include "devHardware.h"
#include <avr/io.h>
#include <avr/interrupt.h>
//---------------------------------------------------------------------------------------



//---------------------------------------------------------------------------------------
AHardware * _hardware = NULL;//Указатель на железо
//---------------------------------------------------------------------------------------







/* //===================================================================================*
* //                                                                                    *
* // Constructor																		*
* //------------------------------------------------------------------------------------*
*///
AHardware :: AHardware()
	:
	m_lock(false)
{
	_hardware = this;	
}
//---------------------------------------------------------------------------------------






/* //===================================================================================*
* //                                                                                    *
* // Constructor																		*
* //------------------------------------------------------------------------------------*
*///
AHardware* AHardware :: instance()
{
	return _hardware;
}
//---------------------------------------------------------------------------------------






/* //===================================================================================*
* //                                                                                    *
* // инциализация системы																*
* //------------------------------------------------------------------------------------*
*///
void AHardware :: initialization()
{
	motors.		initialization();
	time.		initialization();		
	power.		initialization();
	ledMatrix.	initialization();
	uart.		initialization();
	adc.		initialization();
	servo.		initialization();
	sei();
}
//---------------------------------------------------------------------------------------








/* //===================================================================================*
* //                                                                                    *
* // Системное обновление																*
* //------------------------------------------------------------------------------------*
*///
void  AHardware :: update()
{
	if (!m_lock)
	{
		m_lock = true;	
		//		
		time.		update();
		adc.		update(time);
		ledMatrix.	update(time);
		power.		update(time);
		servo.		update(time);
		//
		m_lock = false;
	}		
}
//---------------------------------------------------------------------------------------






/* //===================================================================================*
* //                                                                                    *
* // Системное обновление вызывающие извне												*
* //------------------------------------------------------------------------------------*
*///
void  AHardware :: updateProcess()
{
	if (!m_lock)
	{
		m_lock = true;
		//
		time.		update();
		adc.		update(time);
		ledMatrix.	update(time);
		power.		update(time);
		servo.		update(time);
		//		
		m_lock = false;
	}
}
//---------------------------------------------------------------------------------------

